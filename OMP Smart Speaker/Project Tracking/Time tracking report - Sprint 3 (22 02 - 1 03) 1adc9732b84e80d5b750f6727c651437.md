# Time tracking report - Sprint 3 (22.02 - 1.03)

We were using GitLab for tracking time before ongoing Sprint 4. Starting from Sprint 4 we will utilise toggl with its convenient time reports.

Here is the report generated by python script:

```jsx
Detailed Time Tracking Report for Sprint: Sprint 3

Member: s.gatin
----------------------------------------------------------------------
Issue (IID - Title)                                 Time Logged (hrs)
----------------------------------------------------------------------
33 - Set up Rhasspy sentences.ini                                3.00
30 - Create issue template                                       0.25
29 - DDD: Event Storming                                         4.00
22 - Setup Rhasspy for development                               3.00
16 - Research Rhasspy framework                                  4.00
----------------------------------------------------------------------
Total for s.gatin                                               14.25

Member: p.timofeev
----------------------------------------------------------------------
Issue (IID - Title)                                 Time Logged (hrs)
----------------------------------------------------------------------
32 - Create simple python backend                               12.00
----------------------------------------------------------------------
Total for p.timofeev                                            12.00

Member: al.aksenov
----------------------------------------------------------------------
Issue (IID - Title)                                 Time Logged (hrs)
----------------------------------------------------------------------
31 - Analyze TTS solutions                                      12.00
----------------------------------------------------------------------
Total for al.aksenov                                            12.00

Member: m.kozhinov
----------------------------------------------------------------------
Issue (IID - Title)                                 Time Logged (hrs)
----------------------------------------------------------------------
27 - Add detailed description of notifications flow within back-end               1.00
25 - Create final presentation with main sections specified               3.00
24 - Update strategic planning for project                       3.00
23 - Create time-tracking automated tool                         6.00
21 - Create task description for Sprint 3                        1.00
----------------------------------------------------------------------
Total for m.kozhinov                                            14.00

Member: i.parfenov
----------------------------------------------------------------------
Issue (IID - Title)                                 Time Logged (hrs)
----------------------------------------------------------------------
27 - Add detailed description of notifications flow within back-end               8.00
26 - Add high-level services description for back-end               4.00
----------------------------------------------------------------------
Total for i.parfenov                                            12.00

Overall total time logged across all members: 64.25 hours
```

Link to our board: [link](https://gitlab.pg.innopolis.university/smart-speaker-group/smart-speaker-codebase/-/issues/27). You can navigate there and check the tasks with label **Sprint 3**

Starting from the next submission we will use toggl reports.

In previous sprints the time tracking was terrible as you remember from our presentation. But we are doing consistent improvements and hope in future sprints provide better reports.

---

Here is the python code with script and access token to validate the correctness of time report from above. You can run it and see the actual result:

```jsx
import requests
import sys

# --- GitLab Configuration ---
GITLAB_HOST = "https://gitlab.pg.innopolis.university"
PROJECT_FULL_PATH = "smart-speaker-group/smart-speaker-codebase"
GITLAB_TOKEN = "glpat-n8KYjF5mZ7scXWd1QWNm"
HEADERS = {"PRIVATE-TOKEN": GITLAB_TOKEN}

# Which sprint label to filter
TARGET_SPRINT = "Sprint 3"

def main():
    # 1) Build a GraphQL query that fetches issues with their labels and timelogs
    query = f"""
    query {{
      project(fullPath: "{PROJECT_FULL_PATH}") {{
        issues(first: 100) {{
          nodes {{
            iid
            title
            labels {{
              nodes {{
                title
              }}
            }}
            timelogs(first: 100) {{
              nodes {{
                user {{
                  username
                }}
                timeSpent  # in seconds
                spentAt
              }}
            }}
          }}
        }}
      }}
    }}
    """

    # 2) Send the GraphQL request
    graphql_url = f"{GITLAB_HOST}/api/graphql"
    response = requests.post(graphql_url, headers=HEADERS, json={'query': query})
    if response.status_code != 200:
        print(f"GraphQL query failed with status {response.status_code}.")
        print("Response text:", response.text)
        sys.exit(1)
    data = response.json()

    # Check for GraphQL errors
    if "errors" in data:
        print("GraphQL returned errors:")
        for err in data["errors"]:
            print(err)
        sys.exit(1)

    # 3) Extract the issues data
    project_data = data.get("data", {}).get("project")
    if not project_data:
        print("No project data found. Check PROJECT_FULL_PATH or permissions.")
        sys.exit(1)

    issues_nodes = project_data.get("issues", {}).get("nodes", [])
    if not issues_nodes:
        print("No issues returned by GraphQL.")
        sys.exit(0)

    # 4) Filter issues by the sprint label
    sprint_issues = []
    for issue in issues_nodes:
        label_list = [lbl["title"] for lbl in issue["labels"]["nodes"]]
        if any(lbl.strip().lower() == TARGET_SPRINT.lower() for lbl in label_list):
            sprint_issues.append(issue)

    if not sprint_issues:
        print(f"No issues found with label '{TARGET_SPRINT}'.")
        sys.exit(0)

    # 5) Build a dictionary for the final report
    # { username: { "iid - title": total_hours, ... }, ... }
    report = {}

    for issue in sprint_issues:
        iid = issue["iid"]
        title = issue["title"]
        timelogs = issue["timelogs"]["nodes"]

        # If there are no timelogs, skip
        if not timelogs:
            continue

        for log in timelogs:
            user = log["user"]["username"] if log["user"] else "unknown"
            time_spent_sec = log["timeSpent"] or 0
            time_spent_hrs = time_spent_sec / 3600.0

            if user not in report:
                report[user] = {}
            task_key = f"{iid} - {title}"
            report[user][task_key] = report[user].get(task_key, 0) + time_spent_hrs

    # 6) Print the final report
    print(f"\nDetailed Time Tracking Report for Sprint: {TARGET_SPRINT}\n")
    overall_total = 0.0
    for member, tasks in report.items():
        member_total = sum(tasks.values())
        overall_total += member_total
        print(f"Member: {member}")
        print("-" * 70)
        print(f"{'Issue (IID - Title)':50} {'Time Logged (hrs)':>18}")
        print("-" * 70)
        for task, hours in tasks.items():
            print(f"{task:50} {hours:18.2f}")
        print("-" * 70)
        print(f"{'Total for ' + member:50} {member_total:18.2f}\n")

    print(f"Overall total time logged across all members: {overall_total:.2f} hours")

if __name__ == "__main__":
    main()
```